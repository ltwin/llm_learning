# AIé™ªä¼´ç²¾çµæœåŠ¡

åŸºäºFastAPI+LangChain+LangGraph+Milvusçš„æ™ºèƒ½AIé™ªä¼´ç²¾çµæœåŠ¡ï¼Œå…·å¤‡å¯¹è¯è®°å¿†ã€é•¿æœŸè®°å¿†RAGå’Œè§’è‰²è®¾å®šåŠŸèƒ½ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

### 1. ğŸ§  æ™ºèƒ½å¯¹è¯è®°å¿†
- **çŸ­æœŸè®°å¿†**: ä¿å­˜å¯¹è¯å†å²ï¼Œå®ç°è¿ç»­å¯¹è¯
- **é•¿æœŸè®°å¿†**: è‡ªåŠ¨æå–é‡è¦ä¿¡æ¯å­˜å‚¨åˆ°çŸ¥è¯†åº“
- **è®°å¿†æ£€ç´¢**: åŸºäºå‘é‡ç›¸ä¼¼åº¦çš„æ™ºèƒ½è®°å¿†å¬å›
- **è®°å¿†ç®¡ç†**: æ”¯æŒè®°å¿†çš„å¢åˆ æ”¹æŸ¥å’Œç»Ÿè®¡

### 2. ğŸ­ ä¸°å¯Œè§’è‰²è®¾å®š
- **è§’è‰²èƒŒæ™¯**: å§“åã€å¹´é¾„ã€èŒä¸šã€èƒŒæ™¯æ•…äº‹
- **ä¸–ç•Œè§‚è®¾å®š**: è‡ªå®šä¹‰è§’è‰²æ‰€å¤„çš„ä¸–ç•Œè§‚
- **æ€§æ ¼ç‰¹å¾**: å¤šç»´åº¦æ€§æ ¼è®¾å®šï¼ˆå¹½é»˜åº¦ã€æ­£å¼åº¦ç­‰ï¼‰
- **äººé™…å…³ç³»ç½‘**: æ”¯æŒå¤æ‚çš„äººç‰©å…³ç³»è®¾å®š
- **æŠ€èƒ½ç‰¹é•¿**: è§’è‰²çš„ä¸“ä¸šæŠ€èƒ½å’Œç‰¹é•¿

### 3. ğŸ”„ æ™ºèƒ½å¯¹è¯æµç¨‹
- **LangGraphé©±åŠ¨**: åŸºäºçŠ¶æ€å›¾çš„å¯¹è¯æµç¨‹ç®¡ç†
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: ç»“åˆå†å²å¯¹è¯å’Œç›¸å…³è®°å¿†
- **ä¸ªæ€§åŒ–å›å¤**: æ ¹æ®è§’è‰²è®¾å®šç”Ÿæˆç¬¦åˆäººè®¾çš„å›å¤
- **æƒ…æ„Ÿç†è§£**: ç†è§£ç”¨æˆ·æƒ…æ„Ÿå¹¶ç»™å‡ºåˆé€‚å›åº”

### 4. ğŸ—„ï¸ å‘é‡çŸ¥è¯†åº“
- **Milvuså­˜å‚¨**: é«˜æ€§èƒ½å‘é‡æ•°æ®åº“
- **è¯­ä¹‰æœç´¢**: åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„çŸ¥è¯†æ£€ç´¢
- **è‡ªåŠ¨ç´¢å¼•**: æ™ºèƒ½å»ºç«‹å‘é‡ç´¢å¼•
- **å®æ—¶æ›´æ–°**: æ”¯æŒçŸ¥è¯†åº“çš„å®æ—¶æ›´æ–°

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FastAPI       â”‚    â”‚   LangChain     â”‚    â”‚   LangGraph     â”‚
â”‚   WebæœåŠ¡       â”‚â”€â”€â”€â”€â”‚   LLMé›†æˆ       â”‚â”€â”€â”€â”€â”‚   å¯¹è¯æµç¨‹      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Milvus        â”‚    â”‚   Sentence      â”‚
         â”‚   å‘é‡æ•°æ®åº“    â”‚â”€â”€â”€â”€â”‚   Transformers  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ å®‰è£…éƒ¨ç½²

### ç¯å¢ƒè¦æ±‚
- Python 3.12+
- Milvus 2.3+
- OpenAI API Key

### 1. å…‹éš†é¡¹ç›®
```bash
cd /root/workspace/learning/llm_learning/rag_use_milvus
```

### 2. å®‰è£…ä¾èµ–
```bash
# ä½¿ç”¨uvå®‰è£…ï¼ˆæ¨èï¼‰
uv sync

# æˆ–ä½¿ç”¨pipå®‰è£…
pip install -e .
```

### 3. é…ç½®ç¯å¢ƒ
```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env
```

é…ç½®ç¤ºä¾‹ï¼š
```env
# OpenAI APIé…ç½®
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_BASE_URL=https://api.openai.com/v1

# Milvusé…ç½®
MILVUS_HOST=localhost
MILVUS_PORT=19530

# åº”ç”¨é…ç½®
APP_HOST=0.0.0.0
APP_PORT=8000
```

### 4. å¯åŠ¨Milvus
```bash
# ä½¿ç”¨Dockerå¯åŠ¨Milvus
docker run -d --name milvus-standalone \
  -p 19530:19530 -p 9091:9091 \
  -v $(pwd)/volumes/milvus:/var/lib/milvus \
  milvusdb/milvus:latest
```

### 5. å¯åŠ¨æœåŠ¡
```bash
# å¼€å‘æ¨¡å¼
python main.py

# æˆ–ä½¿ç”¨uvicorn
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è®¿é—®æ¼”ç¤ºé¡µé¢
æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8000

### 2. APIæ–‡æ¡£
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### 3. åŸºæœ¬ä½¿ç”¨

#### å‘é€èŠå¤©æ¶ˆæ¯
```bash
curl -X POST "http://localhost:8000/chat" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user_001",
    "character_id": "default",
    "message": "ä½ å¥½ï¼Œæˆ‘æ˜¯å°æ˜"
  }'
```

#### åˆ›å»ºè‡ªå®šä¹‰è§’è‰²
```bash
curl -X POST "http://localhost:8000/characters/my_character" \
  -H "Content-Type: application/json" \
  -d '{
    "background": {
      "name": "å°é›ª",
      "occupation": "å­¦ä¹ åŠ©æ‰‹",
      "background_story": "æˆ‘æ˜¯ä¸€ä¸ªä¸“é—¨å¸®åŠ©å­¦ä¹ çš„AIåŠ©æ‰‹...",
      "world_setting": "ç°ä»£æ•™è‚²ç¯å¢ƒ",
      "personality": {
        "traits": ["è€å¿ƒ", "åšå­¦", "å‹å–„"],
        "speaking_style": "æ¸©å’Œè€å¿ƒï¼Œå¾ªå¾ªå–„è¯±",
        "emotional_tendency": "ç§¯æå‘ä¸Šï¼Œé¼“åŠ±å­¦ä¹ ",
        "humor_level": 0.6,
        "formality_level": 0.4
      }
    }
  }'
```

#### æœç´¢è®°å¿†
```bash
curl -X POST "http://localhost:8000/memories/search" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user_001",
    "character_id": "default",
    "query": "æˆ‘çš„çˆ±å¥½",
    "limit": 5
  }'
```

## ğŸ“š APIæ¥å£

### èŠå¤©æ¥å£
- `POST /chat` - å‘é€èŠå¤©æ¶ˆæ¯
- `GET /conversations/{session_id}/summary` - è·å–å¯¹è¯æ‘˜è¦
- `GET /conversations/{session_id}/context` - è·å–å¯¹è¯ä¸Šä¸‹æ–‡

### è§’è‰²ç®¡ç†
- `POST /characters/{character_id}` - åˆ›å»ºè§’è‰²
- `GET /characters/{character_id}` - è·å–è§’è‰²ä¿¡æ¯
- `PUT /characters/{character_id}` - æ›´æ–°è§’è‰²
- `DELETE /characters/{character_id}` - åˆ é™¤è§’è‰²
- `GET /characters` - åˆ—å‡ºæ‰€æœ‰è§’è‰²

### è®°å¿†ç®¡ç†
- `POST /memories/search` - æœç´¢è®°å¿†
- `GET /memories/stats` - è·å–è®°å¿†ç»Ÿè®¡
- `DELETE /memories/{memory_id}` - åˆ é™¤è®°å¿†

### ç³»ç»Ÿç®¡ç†
- `GET /health` - å¥åº·æ£€æŸ¥
- `GET /system/info` - ç³»ç»Ÿä¿¡æ¯
- `POST /system/cleanup` - æ¸…ç†æ—§æ•°æ®

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `OPENAI_API_KEY` | OpenAI APIå¯†é’¥ | å¿…å¡« |
| `OPENAI_BASE_URL` | OpenAI APIåœ°å€ | https://api.openai.com/v1 |
| `MILVUS_HOST` | Milvusä¸»æœºåœ°å€ | localhost |
| `MILVUS_PORT` | Milvusç«¯å£ | 19530 |
| `APP_HOST` | åº”ç”¨ä¸»æœºåœ°å€ | 0.0.0.0 |
| `APP_PORT` | åº”ç”¨ç«¯å£ | 8000 |
| `EMBEDDING_MODEL` | åµŒå…¥æ¨¡å‹ | sentence-transformers/all-MiniLM-L6-v2 |
| `MAX_CONVERSATION_HISTORY` | æœ€å¤§å¯¹è¯å†å² | 20 |
| `MEMORY_IMPORTANCE_THRESHOLD` | è®°å¿†é‡è¦æ€§é˜ˆå€¼ | 0.7 |

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. ä¸ªäººAIåŠ©æ‰‹
- æ—¥å¸¸å¯¹è¯é™ªä¼´
- å­¦ä¹ è¾…å¯¼åŠ©æ‰‹
- æƒ…æ„Ÿæ”¯æŒä¼™ä¼´

### 2. å®¢æœæœºå™¨äºº
- ä¼ä¸šå®¢æˆ·æœåŠ¡
- äº§å“å’¨è¯¢åŠ©æ‰‹
- å”®åæ”¯æŒç³»ç»Ÿ

### 3. æ•™è‚²åº”ç”¨
- è™šæ‹Ÿè€å¸ˆ
- å­¦ä¹ ä¼™ä¼´
- çŸ¥è¯†é—®ç­”ç³»ç»Ÿ

### 4. å¨±ä¹åº”ç”¨
- è§’è‰²æ‰®æ¼”æ¸¸æˆ
- äº’åŠ¨å°è¯´
- è™šæ‹Ÿå¶åƒ

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„
```
rag_use_milvus/
â”œâ”€â”€ main.py              # FastAPIä¸»åº”ç”¨
â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”œâ”€â”€ models.py            # æ•°æ®æ¨¡å‹
â”œâ”€â”€ vector_store.py      # Milvuså‘é‡å­˜å‚¨
â”œâ”€â”€ memory_manager.py    # è®°å¿†ç®¡ç†
â”œâ”€â”€ character_manager.py # è§’è‰²ç®¡ç†
â”œâ”€â”€ conversation_graph.py # LangGraphå¯¹è¯æµç¨‹
â”œâ”€â”€ static/              # é™æ€æ–‡ä»¶
â”‚   â””â”€â”€ index.html       # æ¼”ç¤ºé¡µé¢
â”œâ”€â”€ .env.example         # ç¯å¢ƒé…ç½®ç¤ºä¾‹
â”œâ”€â”€ pyproject.toml       # é¡¹ç›®é…ç½®
â””â”€â”€ README.md            # é¡¹ç›®æ–‡æ¡£
```

### æ‰©å±•å¼€å‘
1. **è‡ªå®šä¹‰è§’è‰²ç±»å‹**: åœ¨`models.py`ä¸­æ‰©å±•è§’è‰²æ¨¡å‹
2. **æ–°å¢è®°å¿†ç±»å‹**: åœ¨`MemoryType`æšä¸¾ä¸­æ·»åŠ æ–°ç±»å‹
3. **è‡ªå®šä¹‰å¯¹è¯æµç¨‹**: ä¿®æ”¹`conversation_graph.py`ä¸­çš„æµç¨‹å›¾
4. **é›†æˆæ–°çš„LLM**: åœ¨é…ç½®ä¸­æ·»åŠ æ–°çš„æ¨¡å‹æ”¯æŒ

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£ã€å¿«é€Ÿçš„Webæ¡†æ¶
- [LangChain](https://langchain.com/) - LLMåº”ç”¨å¼€å‘æ¡†æ¶
- [LangGraph](https://langchain-ai.github.io/langgraph/) - çŠ¶æ€å›¾å¯¹è¯æµç¨‹
- [Milvus](https://milvus.io/) - å‘é‡æ•°æ®åº“
- [Sentence Transformers](https://www.sbert.net/) - æ–‡æœ¬åµŒå…¥æ¨¡å‹

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ Issue
- å‘é€é‚®ä»¶
- åŠ å…¥è®¨è®ºç¾¤

---

**äº«å—ä¸AIç²¾çµçš„ç¾å¥½å¯¹è¯æ—¶å…‰ï¼** ğŸŒŸ